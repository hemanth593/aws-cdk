apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: prod-hello-ingress
  namespace: prod-hello
  annotations:
    # Load Balancer Configuration
    alb.ingress.kubernetes.io/load-balancer-name: prod-hello-alb
    alb.ingress.kubernetes.io/scheme: internal
    alb.ingress.kubernetes.io/target-type: ip
    
    # Subnet selection (private subnets for internal ALB)
    alb.ingress.kubernetes.io/subnets: subnet-0c839145732628bf5,subnet-09b3f781228af13af,subnet-052d7a865ac29bdc5
    
    # Tags for the ALB
    alb.ingress.kubernetes.io/tags: Environment=production,Application=prod-hello,ManagedBy=kubernetes,Component=prod-hello
    
    # Listener Configuration
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
    
    # Load Balancer Attributes
    alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=600
    
    # Health Check Configuration
    alb.ingress.kubernetes.io/healthcheck-path: /
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '10'
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
    alb.ingress.kubernetes.io/healthy-threshold-count: '3'
    alb.ingress.kubernetes.io/unhealthy-threshold-count: '2'
    alb.ingress.kubernetes.io/success-codes: '200-399'
    
    # Target Group Configuration
    alb.ingress.kubernetes.io/target-group-attributes: deregistration_delay.timeout_seconds=30,stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=3600
    
    # External DNS annotation (requires external-dns to be installed)
    external-dns.alpha.kubernetes.io/hostname: pagidh.sre.practice.com
    external-dns.alpha.kubernetes.io/ttl: "300"
    
spec:
  ingressClassName: alb
  rules:
  - host: pagidh.sre.practice.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: prod-hello-service
            port:
              number: 80
